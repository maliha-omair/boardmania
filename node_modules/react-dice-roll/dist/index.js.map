{"version":3,"file":"index.js","sources":["../src/_utils.ts","../src/index.tsx"],"sourcesContent":["import { ReactChild } from 'react';\nimport { TValueClassMap, TFaceTransformMap, TDefaultFaceGrid } from './_types';\n\nexport const valueClassMap: TValueClassMap = {\n    1: 'one',\n    2: 'two',\n    3: 'three',\n    4: 'four',\n    5: 'five',\n    6: 'six',\n};\n\nexport const faceTransformMap: TFaceTransformMap = {\n    1: (translate: number) => ({ transform: `rotateX(-90deg) translate3d(0, 0, ${translate}px)` }),\n    2: (translate: number) => ({ transform: `translate3d(0, 0, ${translate}px)` }),\n    3: (translate: number) => ({ transform: `rotateY(180deg) translate3d(0, 0, ${translate}px)` }),\n    4: (translate: number) => ({ left: '50%', marginLeft: `-${translate}px`, transform: `rotateY(-90deg) translate3d(0, 0, ${translate}px)` }),\n    5: (translate: number) => ({ left: '50%', marginLeft: `-${translate}px`, transform: `rotateY(90deg) translate3d(0, 0, ${translate}px)` }),\n    6: (translate: number) => ({ transform: `rotateX(90deg) translate3d(0, 0, ${translate}px)` }),\n};\n\nexport const defaultFaceGrid: TDefaultFaceGrid = {\n    1: [12],\n    2: [11, 13],\n    3: [6, 12, 18],\n    4: [6, 8, 16, 18],\n    5: [6, 8, 12, 16, 18],\n    6: [6, 8, 11, 13, 16, 18]\n};\n\nexport const faceClasses = [\n    '_3dface _3dface--one',\n    '_3dface _3dface--two',\n    '_3dface _3dface--three',\n    '_3dface _3dface--four',\n    '_3dface _3dface--five',\n    '_3dface _3dface--six'\n];\n\nexport const times = (counter: number, callback: (index: number) => ReactChild) => {\n    const data = [];\n    for(let i = 0; i < counter; i++) {\n        data.push(callback(i));\n    }\n\n    return data;\n}","import * as React from 'react';\nimport './styles.scss';\nimport { TProps, TSingleFace, TValue } from './_types';\nimport { defaultFaceGrid, faceClasses, faceTransformMap, times, valueClassMap } from './_utils';\n\nconst { useState, useEffect, forwardRef, useImperativeHandle } = React;\n\nconst getFaceArray = (size: number, faces: string[], faceBg?: string): TSingleFace[] => {\n    return faceClasses.map((className: string, index: number) => ({\n        className,\n        children: !faces[index] ? (\n            <div className={`defaultFace ${valueClassMap[(index + 1) as TValue]}`}>\n                {times(25, (idx) => (\n                    <div key={idx}>\n                        {defaultFaceGrid[(index + 1) as TValue].includes(idx) && <span />}\n                    </div>\n                ))}\n            </div>\n        ) : null,\n        style: {\n            ...faceTransformMap[(index + 1) as TValue](size / 2),\n            width: size + 'px',\n            height: size + 'px',\n            ...(faceBg && { backgroundColor: faceBg }),\n            ...(faces[index] && { backgroundImage: `url(${faces[index]})` }),\n        },\n    }));\n};\n\ntype TDiceRef = {\n    rollDice: (value: TValue) => void;\n};\n\nconst Dice = forwardRef((props: TProps, ref: React.MutableRefObject<TDiceRef>) => {\n    const { rollingTime = 1000, onRoll, defaultValue = 6, size = 250, faceBg, faces = [], disabled, cheatValue, placement, sound, triggers = ['click'], ...rest } = props;\n    const [value, setValue] = useState<TValue>(defaultValue);\n    const [rolling, setRolling] = useState(false);\n    const [faceArray, setFaceArray] = useState<TSingleFace[]>([]);\n    const [placementStyles, setPlacementStyles] = useState<React.CSSProperties>({});\n    const [buttonStyles, setButtonStyles] = useState<React.CSSProperties>({});\n\n    const handleDiceRoll = (value?: TValue) => {\n        let diceAudio: HTMLAudioElement;\n        if (sound) {\n            diceAudio = new Audio(sound);\n            diceAudio.play();\n        }\n        setRolling(true);\n        setTimeout(() => {\n            let rollValue = Math.floor((Math.random() * 6) + 1) as TValue;\n\n            if (value) rollValue = value;\n            if (cheatValue) rollValue = cheatValue;\n            \n            setRolling(false);\n            setValue(rollValue);\n            \n            if (diceAudio) diceAudio.pause();\n            if (!onRoll) return;\n            onRoll(rollValue);\n        }, rollingTime);\n    };\n\n    useImperativeHandle(ref, () => ({ rollDice: handleDiceRoll }));\n\n    const keyPressHandler = (event: KeyboardEvent) => {\n        if (!triggers?.length || !triggers.includes(event.key)) {\n            return;\n        }\n\n        handleDiceRoll();\n    };\n\n    const clickHandler = () => {\n        if (!triggers?.length || !triggers.includes('click')) {\n            return;\n        }\n\n        handleDiceRoll();\n    };\n\n    useEffect(() => {\n        if (typeof window === 'undefined' || !triggers?.length) {\n            return;\n        }\n        window.addEventListener('keypress', keyPressHandler);\n        // Remove event listeners on cleanup\n        return () => {\n          window.removeEventListener('keypress', keyPressHandler);\n        };\n    }, [triggers]);\n    \n    useEffect(() => {\n        setFaceArray(getFaceArray(size, faces, faceBg));\n    }, [size, faces.length, faceBg]);\n\n    useEffect(() => {\n        const positionStyles = placement?.split('-')?.reduce((acc, curr) => {\n            return { ...acc, [curr]: ['left', 'right'].includes(curr) ? 0 : `-${size}px` };\n        }, {}) as React.CSSProperties;\n        setPlacementStyles(positionStyles);\n    }, [placement, size]);\n\n    useEffect(() => {\n        setButtonStyles({\n            ...rest,\n            ...placementStyles,\n            width: size + 'px',\n            height: size + 'px',\n            filter: disabled ? 'grayscale(100%)' : 'unset' \n        });\n    }, [placementStyles, size, disabled]);\n\n    if (!faceArray?.length) return null;\n\n    return (\n        <button disabled={disabled || rolling} onClick={clickHandler} style={buttonStyles} className={`_space3d ${valueClassMap[value]} ${rolling && 'rolling'}`}>\n            <div className=\"_3dbox\">\n                <div {...faceArray[0]} />\n                <div {...faceArray[1]} />\n                <div {...faceArray[2]} />\n                <div {...faceArray[3]} />\n                <div {...faceArray[4]} />\n                <div {...faceArray[5]} />\n            </div>\n        </button>\n    )\n});\n\nexport default Dice;"],"names":["valueClassMap","faceTransformMap","translate","transform","left","marginLeft","defaultFaceGrid","faceClasses","times","counter","callback","data","i","push","useState","React","useEffect","forwardRef","useImperativeHandle","Dice","props","ref","_a","rollingTime","onRoll","_b","defaultValue","_c","size","faceBg","_d","faces","disabled","cheatValue","placement","sound","_e","triggers","rest","_f","value","setValue","_g","rolling","setRolling","_h","faceArray","setFaceArray","_j","placementStyles","setPlacementStyles","_k","buttonStyles","setButtonStyles","handleDiceRoll","diceAudio","Audio","play","setTimeout","rollValue","Math","floor","random","pause","rollDice","keyPressHandler","event","length","includes","key","window","addEventListener","removeEventListener","map","className","index","children","idx","style","width","height","backgroundColor","backgroundImage","getFaceArray","positionStyles","split","reduce","acc","curr","filter","onClick"],"mappings":"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"}